document.addEventListener("DOMContentLoaded",()=>{function t(t){const n=t/10;return n<0||n>1?2.5:(Math.pow(6*n-2,2)*Math.sin(12*n-3)+6)*(7/22)}function n(t,n,e=1,a=1){return a*Math.exp(-.5*Math.pow((t-n)/e,2))}function e(t,e,a=1,o=1,i=L*L){if(0===e.length)return{mean:2.5,variance:o};e.map(e=>n(t,e.x,a,o)),e.map((t,r)=>e.map((e,s)=>n(t.x,e.x,a,o)+(r===s?i:0)));let r=0,s=0;e.forEach(e=>{const i=n(t,e.x,a,o);r+=i*e.y,s+=i});const d=s>0?r/s:2.5;let l=Infinity;return e.forEach(n=>{l=Math.min(l,Math.abs(t-n.x))}),{mean:d,variance:o*(1-Math.exp(-.5*Math.pow(l/a,2)))+i}}function a(t){return 1/Math.sqrt(2*Math.PI)*Math.exp(-.5*t*t)}function o(t){const n=.31938153,e=-.356563782,a=1.781477937,o=-1.821255978,i=1.330274429,r=1/(1+.2316419*Math.abs(t)),s=1-1/Math.sqrt(2*Math.PI)*Math.exp(-.5*t*t)*(n*r+e*Math.pow(r,2)+a*Math.pow(r,3)+o*Math.pow(r,4)+i*Math.pow(r,5));return t>=0?s:1-s}function i(){if(null!==P){const t=P;return P=null,t}let t=0,n=0;for(;0===t;)t=Math.random();for(;0===n;)n=Math.random();const e=Math.sqrt(-2*Math.log(t)),a=2*Math.PI*n;return P=e*Math.sin(a),e*Math.cos(a)}function r(t,n,e=1.96){return t+e*Math.sqrt(n)}function s(t,n,e,i=.01){if(n<=0)return 0;const r=Math.sqrt(n);if(0===r)return 0;const s=(t-e-i)/r,d=(t-e-i)*o(s)+r*a(s);return d>0?d:0}function d(t,n){n<0&&(n=0);const e=Math.sqrt(n);return t+i()*e}function l(t,n,e,a,o=1.96,i=.01){switch(t){case"EI":return s(n,e,a,i);case"TS":return d(n,e);case"UCB":default:return r(n,e,o)}}function c(){const n=F.labels,a=n.map(n=>t(n)),o=[],i=[],r=[],s=[];n.forEach(t=>{const{mean:n,variance:a}=e(t,q),d=Math.sqrt(a>0?a:0);o.push(n),i.push(n+1.96*d),r.push(n-1.96*d);const c=l(E,n,a,A);s.push(c)}),S.data.datasets[0].data=a,S.data.datasets[1].data=o,S.data.datasets[2].data=i,S.data.datasets[3].data=r,S.data.datasets[4].data=s,S.data.datasets[5].data=q.map(t=>({x:t.x,y:t.y})),S.update()}function u(){I=0,q=[],A=-Infinity,v=null,x&&(x.textContent=I),y&&(y.textContent="N/A"),M&&(M.textContent="N/A"),c()}function p(){const t=F.labels;let n=-Infinity,a=t[0];return t.forEach(t=>{const{mean:o,variance:i}=e(t,q),r=l(E,o,i,A);r>n&&(n=r,a=t)}),a}function h(n){const e=t(n)+2*(Math.random()-.5)*L;q.push({x:n,y:e}),q.sort((t,n)=>t.x-n.x),e>A&&(A=e,v=n),I++,x.textContent=I,y.textContent=A.toFixed(3),M.textContent=v.toFixed(3),c()}const m=document.getElementById("bayesianOptimizationChart");if(!m)return void console.error("Bayesian optimization chart canvas not found.");const f=m.getContext("2d"),b=document.getElementById("addSamplePoint"),x=document.getElementById("iterationCount"),y=document.getElementById("bestValue"),M=document.getElementById("bestX"),g=document.getElementById("acquisitionFunctionSelect"),C=document.getElementById("resetDemoButton");if(!(b&&x&&y&&M))return void console.error("One or more UI elements for Bayesian optimization demo not found.");let I=0,q=[],A=-Infinity,v=null,E="UCB";const w=0,B=10,R=100,L=.1;let P=null;const F={labels:Array.from({length:R},(t,n)=>w+n*(B-w)/(R-1)),datasets:[{label:"Ground truth",data:[],borderColor:"rgba(255, 99, 132, 0.7)",borderWidth:2,pointRadius:0,tension:.1,hidden:!1},{label:"GP mean",data:[],borderColor:"rgba(54, 162, 235, 1)",borderWidth:2,pointRadius:0,tension:.1},{label:"GP confidence interval",data:[],borderColor:"rgba(54, 162, 235, 0.3)",backgroundColor:"rgba(54, 162, 235, 0.1)",borderWidth:1,pointRadius:0,fill:"+1",tension:.1},{label:"GP Confidence Interval (lower)",data:[],borderColor:"rgba(54, 162, 235, 0.3)",borderWidth:1,pointRadius:0,fill:!1,tension:.1},{label:`Acquisition function (${E.toUpperCase()})`,data:[],borderColor:"rgba(75, 192, 192, 1)",borderWidth:2,pointRadius:0,tension:.1,yAxisID:"yAcquisition"},{label:"Sampled points",data:[],borderColor:"rgba(153, 102, 255, 1)",backgroundColor:"rgba(153, 102, 255, 1)",pointRadius:5,pointHoverRadius:7,showLine:!1,type:"scatter"}]},S=new Chart(f,{type:"line",data:F,options:{responsive:!1,maintainAspectRatio:!1,animation:{duration:0},scales:{x:{type:"linear",position:"bottom",title:{display:!0,text:"x"}},y:{type:"linear",position:"left",title:{display:!0,text:"f(x)"},min:-2,max:8},yAcquisition:{type:"linear",position:"right",title:{display:!0,text:"Acquisition value"},grid:{drawOnChartArea:!1},min:-2,max:8}},plugins:{tooltip:{mode:"index",intersect:!1},legend:{position:"top",labels:{filter:function(t){return 3!==t.datasetIndex&&5!==t.datasetIndex}}}}}});b.addEventListener("click",()=>{h(p())}),g?g.addEventListener("change",t=>{E=t.target.value,S.data.datasets[4].label=`Acquisition Function (${E.toUpperCase()})`,"EI"===E?(S.options.scales.yAcquisition.min=-.05,S.options.scales.yAcquisition.max=1):(S.options.scales.yAcquisition.min=-2,S.options.scales.yAcquisition.max=8),c()}):console.warn('Acquisition function select element not found. Add an HTML select with id="acquisitionFunctionSelect".'),C?C.addEventListener("click",u):console.warn('Reset demo button element not found. Add an HTML button with id="resetDemoButton".'),c()});